"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function getFunctionName(e){var n=e.name;return null===n||void 0===n||""===n?ANONYMOUS:"~~~ "+n+"() ~~~"}function serialize(e){var n=[],t=[];return JSON.stringify(e,function(e){return function(r,i){if(!0===i)return!0;if(i===1/0)return INFINITY;if(i===-1/0)return NEGATIVE_INFINITY;if(0===i)return ZERO;if(void 0===i)return UNDEFINED;if(null===i)return NULL;if(!1===i)return FALSE;if(-0===i)return ZERO;if(""===i)return EMPTY_STRING;switch(typeof i){case"string":case"number":return i;case"function":return getFunctionName(i)}if(n.length>0){var o=n.indexOf(this);~o?n.splice(o+1):n.push(this),~o?t.splice(o,1/0,r):t.push(r),~n.indexOf(i)&&(i=CIRCULAR)}else n.push(i);return null==e?i:e.call(this,r,i)}}(null))}Object.defineProperty(exports,"__esModule",{value:!0});var merge=_interopDefault(require("ramda/src/merge")),has=_interopDefault(require("ramda/src/has")),forEach=_interopDefault(require("ramda/src/forEach")),head=_interopDefault(require("ramda/src/head")),tail=_interopDefault(require("ramda/src/tail")),contains=_interopDefault(require("ramda/src/contains")),isEmpty=_interopDefault(require("ramda/src/isEmpty")),is=_interopDefault(require("ramda/src/is")),keys=_interopDefault(require("ramda/src/keys")),allPass=_interopDefault(require("ramda/src/allPass")),complement=_interopDefault(require("ramda/src/complement")),isNil=_interopDefault(require("ramda/src/isNil")),length=_interopDefault(require("ramda/src/length")),last=_interopDefault(require("ramda/src/last")),isCreateSocketValid=function(e){return!isNil(e)},isHostValid=allPass([is(String),complement(isEmpty)]),isPortValid=allPass([complement(isNil),is(Number),function(e){return e>=1&&e<=65535}]),onCommandValid=function(e){return"function"==typeof e},validate=function(e){var n=e.createSocket,t=e.host,r=e.port,i=e.onCommand;if(!isCreateSocketValid(n))throw new Error("invalid createSocket function");if(!isHostValid(t))throw new Error("invalid host");if(!isPortValid(r))throw new Error("invalid port");if(!onCommandValid(i))throw new Error("invalid onCommand handler")},logger=function(){return function(e){return{features:{log:function(n,t){return void 0===t&&(t=!1),e.send("log",{level:"debug",message:n},!!t)},debug:function(n,t){return void 0===t&&(t=!1),e.send("log",{level:"debug",message:n},!!t)},warn:function(n){return e.send("log",{level:"warn",message:n},!0)},error:function(n,t){return e.send("log",{level:"error",message:n,stack:t},!0)}}}}},image=function(){return function(e){return{features:{image:function(n){var t=n.uri,r=n.preview,i=n.filename,o=n.width,s=n.height,a=n.caption;return e.send("image",{uri:t,preview:r,filename:i,width:o,height:s,caption:a})}}}}},benchmark=function(){return function(e){var n=e.startTimer;return{features:{benchmark:function(t){var r=[],i=n(),o=function(e){var n=0===length(r)?0:last(r).time,t=i();r.push({title:e,time:t,delta:t-n})};r.push({title:t,time:0,delta:0});var s=function(n){o(n),e.send("benchmark.report",{title:t,steps:r})};return{step:o,stop:s,last:s}}}}}},stateResponses=function(){return function(e){return{features:{stateActionComplete:function(n,t,r){return void 0===r&&(r=!1),e.send("state.action.complete",{name:n,action:t},!!r)},stateValuesResponse:function(n,t,r){return void 0===r&&(r=!0),e.send("state.values.response",{path:n,value:t,valid:r})},stateKeysResponse:function(n,t,r){return void 0===r&&(r=!0),e.send("state.keys.response",{path:n,keys:t,valid:r})},stateValuesChange:function(n){return e.send("state.values.change",{changes:n})},stateBackupResponse:function(n){return e.send("state.backup.response",{state:n})}}}}},apiResponse=function(){return function(e){return{features:{apiResponse:function(n,t,r){var i=!(t&&t.status&&is(Number,t.status)&&t.status>=200&&t.status<=299);e.send("api.response",{request:n,response:t,duration:r},i)}}}}},clear=function(){return function(e){return{features:{clear:function(){return e.send("clear")}}}}},UNDEFINED="~~~ undefined ~~~",NULL="~~~ null ~~~",FALSE="~~~ false ~~~",ZERO="~~~ zero ~~~",EMPTY_STRING="~~~ empty string ~~~",CIRCULAR="~~~ Circular Reference ~~~",ANONYMOUS="~~~ anonymous function ~~~",INFINITY="~~~ Infinity ~~~",NEGATIVE_INFINITY="~~~ -Infinity ~~~",hasHirezNodeTimer=!1,defaultPerformanceNow=function(e){return Date.now()},nativePerformance="undefined"!=typeof window&&window&&(window.performance||window.msPerformance||window.webkitPerformance),performanceNow=defaultPerformanceNow,delta=function(e){return performanceNow()-e};hasHirezNodeTimer?(performanceNow=process.hrtime,delta=function(e){return performanceNow(e)[1]/1e6}):global.nativePerformanceNow?performanceNow=global.nativePerformanceNow:nativePerformance&&(performanceNow=function(){return nativePerformance.now&&nativePerformance.now()});var start=function(){var e=performanceNow();return function(){return delta(e)}},corePlugins=[image(),logger(),benchmark(),stateResponses(),apiResponse(),clear()],DEFAULT_OPTIONS={createSocket:null,host:"localhost",port:9090,name:"reactotron-core-client",secure:!1,plugins:corePlugins,safeRecursion:!0,onCommand:function(e){return null},onConnect:function(){return null},onDisconnect:function(){return null}},isReservedFeature=function(e){return contains(e,["options","connected","socket","plugins","configure","connect","send","use","startTimer"])},Client=function(){function e(){var e=this;this.options=merge({},DEFAULT_OPTIONS),this.connected=!1,this.socket=null,this.plugins=[],this.sendQueue=[],this.isReady=!1,this.startTimer=function(){return start()},this.send=function(n,t,r){if(void 0===t&&(t={}),void 0===r&&(r=!1),e.socket){var i=serialize({type:n,payload:t,important:!!r});e.isReady?e.socket.send(i):e.sendQueue.push(i)}}}return e.prototype.configure=function(e){void 0===e&&(e={});var n=merge(this.options,e);return validate(n),this.options=n,has("length",this.options.plugins)&&forEach(this.use.bind(this),this.options.plugins),this},e.prototype.connect=function(){var e=this;this.connected=!0;var n=this.options,t=n.createSocket,r=n.secure,i=n.host,o=n.port,s=n.name,a=n.userAgent,u=n.environment,c=n.reactotronVersion,l=this.options,f=l.onCommand,p=l.onConnect,d=l.onDisconnect,m=t((r?"wss":"ws")+"://"+i+":"+o),h=function(){for(p&&p(),forEach(function(e){return e.onConnect&&e.onConnect()},e.plugins),e.isReady=!0,e.send("client.intro",{host:i,port:o,name:s,userAgent:a,reactotronVersion:c,environment:u});!isEmpty(e.sendQueue);){var n=head(e.sendQueue);e.sendQueue=tail(e.sendQueue),e.socket.send(n)}},v=function(){e.isReady=!1,d&&d(),forEach(function(e){return e.onDisconnect&&e.onDisconnect()},e.plugins)},g=function(n){var t=JSON.parse(n);f&&f(t),forEach(function(e){return e.onCommand&&e.onCommand(t)},e.plugins)};return m.on?(m.on("open",h),m.on("close",v),m.on("message",g)):(m.onopen=h,m.onclose=v,m.onmessage=function(e){return g(e.data)}),this.socket=m,this},e.prototype.display=function(e){void 0===e&&(e={});var n=e.name,t=e.value,r=e.preview,i=e.image,o=e.important,s=void 0!==o&&o,a={name:n,value:t||null,preview:r||null,image:i||null};this.send("display",a,s)},e.prototype.reportError=function(e){this.error(e)},e.prototype.use=function(e){var n=this;if("function"!=typeof e)throw new Error("plugins must be a function");var t=e.bind(this)(this);if(!is(Object,t))throw new Error("plugins must return an object");if(t.features){if(!is(Object,t.features))throw new Error("features must be an object");forEach(function(e){var r=t.features[e];if("function"!=typeof r)throw new Error("feature "+e+" is not a function");if(isReservedFeature(e))throw new Error("feature "+e+" is a reserved name");n[e]=r},keys(t.features))}return this.plugins.push(t),t.onPlugin&&"function"==typeof t.onPlugin&&t.onPlugin.bind(this)(this),this},e}(),createClient=function(e){var n=new Client;return n.configure(e),n};exports.corePlugins=corePlugins,exports.Client=Client,exports.createClient=createClient;
//# sourceMappingURL=reactotron-core-client.js.map
